#!/bin/sh -e

VERSION_MAJOR=7.2
VERSION=7.2.4
TARBALL=.mysql-cluster-${VERSION}.tar.gz
URL=http://dev.mysql.com/get/Downloads/MySQL-Cluster-${VERSION_MAJOR}/mysql-cluster-gpl-${VERSION}.tar.gz/from/http://www.mirrorservice.org/sites/ftp.mysql.com/
DIR=mysql-cluster-${VERSION}

# Build options to speed up build for development
# TODO Don't use these when building/testing final package
export MYSQL_BUILD_CC="ccache gcc"
export MYSQL_BUILD_CXX="ccache g++"
export DEB_BUILD_OPTIONS=nocheck

# Download original source code
if [ ! -f ${TARBALL} ]
then
	wget -O ${TARBALL} ${URL}
fi

# Remove any old copies of packages
rm -rf *.deb *.changes *.log

# Extract archive, add debian files
rm -rf ${DIR}
mkdir ${DIR}
tar -C ${DIR} --strip-components=1 -zxf ${TARBALL}
cp -arv debian ${DIR}

# Compile packages
cd ${DIR}
dpkg-buildpackage -b 2>&1 | tee build.log
cd ..

# Lintian checks
lintian -c *.deb 2>&1 | tee lintian.log

# Cleanup and done
echo Done

